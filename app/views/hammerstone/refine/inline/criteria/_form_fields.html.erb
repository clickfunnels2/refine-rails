<%= form.hidden_field :stable_id %>
<%= form.hidden_field :client_id %>
<%= form.hidden_field :condition_id %>
<%= form.hidden_field :conjunction%>
<%= form.hidden_field :position %>

<label style="color: black;"><%= @criterion.condition.display %></label>

<%= form.fields :input_attributes, model: @criterion.input do |input_fields| %>
  <%# Clause Select %>
  <div class="refine-criterion-clause-container">
    <%= input_fields.collection_select :clause,
      @criterion.condition.clauses,
      :id,
      :display,
      {},
      class: "refine-clause-select",
      data: {action: "change->refine--condition-form#refresh"}
    %>
  </div>

  <%# Input Value %>
  <% unless ['st', 'nst'].include? @criterion.input.clause %>
    <%= render @criterion.input_partial, criterion: @criterion, form: form, input_fields: input_fields %>
  <% end %>

  <%# Count Refinement  %>
  <% if @criterion.condition.has_count_refinement? %>
    <label style="color: black;"><%= @criterion.condition.get_count_refinement_condition.display %></label>
    <%= input_fields.fields :count_refinement_attributes, model: @criterion.input.count_refinement do |count_fields| %>
      <div class="refine-criterion-clause-container">
        <%= count_fields.collection_select :clause,
          @criterion.condition.get_count_refinement_condition.clauses,
          :id,
          :display,
          {},
          class: "refine-clause-select",
          data: {action: "change->refine--condition-form#refresh"}
        %>
      </div>

      <% unless ['st', 'nst'].include? @criterion.input.count_refinement.clause %>
        <%= render "hammerstone/refine/inline/inputs/numeric_condition", input_fields: count_fields %>
      <% end %>
    <% end %>

  <% end %>


<% end %>

<% @error_messages&.each do |msg| %>
  <p class="refine-criterion-error">
    <%= msg %>
  </p>
<% end %>

<div class="refine-filter-builder-dropdown-button-container">
  <button class="refine--inline-btn" data-action="click->refine--popup#hide" type="button">
    <%= t('global.buttons.cancel') %>
  </button>
  <%= form.submit t('global.buttons.apply'), class: "refine--inline-btn" %>
</div>
